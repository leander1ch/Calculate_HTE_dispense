# HTE Dispense Calculator

<p align="center">
  <img src="logo_Scat.png" alt="SwissCat+ EPFL" width="150"/>
</p>

This repository contains a Python script for calculating reagent and solvent amounts for high-throughput experimentation (HTE) reactions. The script guides the user through entering reagents, specifying dispensing locations on a plate, and calculating masses or volumes required in each well.

## Usage
## Calculator Usage

```
python hte_calculator.py [--preload my_reagents.py]
```

The script will interactively prompt for reagent information and plate setup. Results are saved as an Excel file summarizing the amounts for each well and total consumption. If `--preload` is supplied, the given Python file must define `PRELOADED_REAGENTS`, a list of dictionaries describing reagents to load before prompting.

During execution you will be asked for a reaction name (used for the Excel/figure filenames) and the desired plate layout (24, 48 or 96 wells). After entering reagents, the script displays the current list and lets you add more if needed. Warnings are shown if any well lacks solvent or the limiting reagent. A colour-coded layout image is also created for quick visual inspection of reagent distribution.
Solvent amounts are applied directly according to each solvent's location mask rather than being averaged over all solvents.

### Example

```bash
python hte_calculator.py --preload example_reagents.py
```

This writes `actual_<name>.xlsx` which lists the amounts per well.

## Requirements
- Python 3.8+
- pandas
- requests
- openpyxl
- matplotlib

Install dependencies with:

```
pip install -r requirements.txt
```

## Workflow Checker

`workflow_checker.py` compares a workflow Excel file with the output
generated by `hte_calculator.py` and can write the calculated amounts
directly back into the workflow.  Run it with the calculator export and
the **empty** workflow file.  Use `--fill` to modify the workflow in
place before the first orbital shaker step:

```
python workflow_checker.py actual.xlsx workflow_empty.xlsx --fill
```

Add `--visualize` to generate plate layout images using `layout_parser.py`:

```bash
python workflow_checker.py actual.xlsx workflow_empty.xlsx --fill --visualize
```

This will call `layout_parser.py` internally to create PNG files showing
the reagent distribution and workflow steps.

### Complete workflow

1. Run `hte_calculator.py` to produce `actual.xlsx`.
2. Fill in the virtual twin in ArcSuite and make sure the product names match the ones
   in `actual.xlsx`.
3. Download the empty workflow file and fill in the product names and reaction conditions.
4. Run `workflow_checker.py actual.xlsx empty.xlsx --fill` to populate the
   workflow file with dispense volumes.
5. (Optional) Re-run with `--visualize` to create layout images for review.


## Visualize Existing Workflow

Do you want to visualize an existing workflow? Use `layout_parser.py`:

```bash
python layout_parser.py workflow.xlsx
```